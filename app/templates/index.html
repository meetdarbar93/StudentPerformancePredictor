<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Student Performance Predictor</title>

  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

  <!-- External CSS -->
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
  <div class="page">
    <header class="topbar">
      <div class="brand">
        <div class="logo">üéì</div>
        <div class="brand-text">
          <div class="app-name">Student Performance</div>
          <div class="app-sub">Predictor</div>
        </div>
      </div>
      <nav class="top-actions">
        <button class="btn subtle" type="button" id="btnReset">Reset</button>
        <a href="{{ url_for('routes.notes') }}" class="btn subtle">View Explanation Notes</a>

      </nav>
    </header>

    <main class="center-area">
      <section class="card">
        <h1 class="card-title">Predict Student Outcome</h1>
        <p class="card-sub">Material-style + premium form Fill inputs and click <strong>Predict</strong>.</p>

        <form action="{{ url_for('routes.make_prediction') }}" method="post" id="predictForm" novalidate>
          <div class="grid">

            <!-- Hours Studied -->
            <div class="form-group" data-field="hours_studied">
              <input type="number" step="0.1" min="0" max="24" name="hours_studied" id="hours" required />
              <label for="hours">Hours Studied (e.g. 3.5)</label>
              <small class="hint">0 - 24</small>
              <div class="error-text" aria-live="polite"></div>
            </div>

            <!-- Attendance -->
            <div class="form-group" data-field="attendance">
              <input type="number" step="0.1" min="0" max="100" name="attendance" id="attendance" required />
              <label for="attendance">Attendance %</label>
              <small class="hint">0 - 100</small>
              <div class="error-text" aria-live="polite"></div>
            </div>

            <!-- Previous Score -->
            <div class="form-group" data-field="previous_score">
              <input type="number" step="0.1" min="0" max="100" name="previous_score" id="prev" required />
              <label for="prev">Previous Test Score</label>
              <small class="hint">0 - 100</small>
              <div class="error-text" aria-live="polite"></div>
            </div>

            <!-- Assignments Completed -->
            <div class="form-group" data-field="assignments_completed">
              <input type="number" min="0" max="12" name="assignments_completed" id="assign" required />
              <label for="assign">Assignments Completed</label>
              <small class="hint">Max 12</small>
              <div class="error-text" aria-live="polite"></div>
            </div>

            <!-- Sleep Hours -->
            <div class="form-group" data-field="sleep_hours">
              <input type="number" step="0.1" min="0" max="24" name="sleep_hours" id="sleep" required />
              <label for="sleep">Sleep Hours</label>
              <small class="hint">0 - 24</small>
              <div class="error-text" aria-live="polite"></div>
            </div>

            <!-- Participation -->
            <div class="form-group select-group" data-field="participation">
              <select name="participation" id="participation" required>
                <option value=""></option>
                <option value="Low">Low</option>
                <option value="Medium">Medium</option>
                <option value="High">High</option>
              </select>
              <label class="floating-label" for="participation">Participation Level</label>
              <div class="error-text" aria-live="polite"></div>
            </div>

          </div>

          <div class="actions">
            <button type="submit" class="btn primary">Predict</button>
            <button type="button" class="btn outline" id="btnClear">Clear</button>
          </div>
        </form>
      </section>

      <!-- optional result card placeholder -->
      <aside class="result-card" id="resultCard" hidden>
        <h3>Prediction</h3>
        <div id="resultText"></div>
      </aside>
    </main>

    <footer class="footer">
      <small>Built with ‚ù§Ô∏è ‚Ä¢ Premium Material UI</small>
    </footer>
  </div>

  <script>
    // ======= Validation logic (custom Material-style, English) =======
    (function () {
      const form = document.getElementById('predictForm');
      const groups = form.querySelectorAll('.form-group');
      const resetBtn = document.getElementById('btnReset');
      const clearBtn = document.getElementById('btnClear');

      // Helpers
      function setError(group, message) {
        group.classList.add('error');
        const err = group.querySelector('.error-text');
        if (err) err.textContent = message;
      }
      function clearError(group) {
        group.classList.remove('error');
        const err = group.querySelector('.error-text');
        if (err) err.textContent = '';
      }
      function setFilledState(el) {
        const parent = el.closest('.form-group');
        if (!parent) return;
        if (el.value && el.value.toString().trim() !== '') {
          parent.classList.add('filled');
        } else {
          parent.classList.remove('filled');
        }
      }

      // Field validators
      function validateField(group) {
        const input = group.querySelector('input, select');
        const name = input ? input.name : null;
        if (!input) return true;

        clearError(group);
        const val = input.value;

        // Required
        if (input.hasAttribute('required')) {
          if (val === null || val === undefined || val.toString().trim() === '' || (input.tagName.toLowerCase() === 'select' && val === '')) {
            setError(group, 'This field is required.');
            return false;
          }
        }

        // If empty but not required, it's valid
        if (val === '' || val === null || val === undefined) return true;

        // Numeric range checks for number inputs
        if (input.type === 'number' || input.tagName.toLowerCase() === 'input') {
          const num = parseFloat(val);
          const min = input.hasAttribute('min') ? parseFloat(input.getAttribute('min')) : null;
          const max = input.hasAttribute('max') ? parseFloat(input.getAttribute('max')) : null;

          if (!isNaN(min) && num < min) {
            setError(group, `Value must be at least ${min}.`);
            return false;
          }
          if (!isNaN(max) && num > max) {
            setError(group, `Value must be at most ${max}.`);
            return false;
          }
          if (isNaN(num)) {
            setError(group, 'Please enter a valid number.');
            return false;
          }
        }

        return true;
      }

      // Wire up events
      groups.forEach(group => {
        const input = group.querySelector('input, select');
        if (!input) return;

        // update filled state on input/change
        input.addEventListener('input', () => {
          clearError(group);
          setFilledState(input);
        });
        input.addEventListener('change', () => {
          clearError(group);
          setFilledState(input);
        });

        // blur validation
        input.addEventListener('blur', () => {
          validateField(group);
        });

        // init filled state
        setFilledState(input);
      });

      // form submit handler
      form.addEventListener('submit', function (e) {
        let ok = true;
        groups.forEach(group => {
          const valid = validateField(group);
          if (!valid) ok = false;
        });
        if (!ok) {
          e.preventDefault();
          // focus the first invalid input
          const firstErr = form.querySelector('.form-group.error input, .form-group.error select');
          if (firstErr) firstErr.focus();
        }
        // else allow submit to server
      });

      // Reset and Clear behavior
      resetBtn.addEventListener('click', function () {
        form.reset();
        groups.forEach(g => {
          clearError(g);
          const inp = g.querySelector('input, select');
          if (inp) setFilledState(inp);
        });
      });

      clearBtn.addEventListener('click', function () {
        form.reset();
        groups.forEach(g => {
          clearError(g);
          const inp = g.querySelector('input, select');
          if (inp) setFilledState(inp);
        });
      });

    })();
  </script>
</body>
</html>
